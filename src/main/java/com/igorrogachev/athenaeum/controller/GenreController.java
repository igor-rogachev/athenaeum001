package com.igorrogachev.athenaeum.controller;


import com.igorrogachev.athenaeum.domain.Genre;
import com.igorrogachev.athenaeum.repository.GenreRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import java.util.ArrayList;

import java.util.List;

@Controller    // This means that this class is a Controller
@RequestMapping("/genre") // This means URL's start with /demo (after Application path)
public class GenreController {

    @Autowired // This means to get the bean called userRepository
    // Which is auto-generated by Spring, we will use it to handle the data
    private GenreRepository genreRepository;

    @GetMapping("/add") // Map ONLY GET Requests ??? but what about PUT or POST ???
    // @PostMapping("/add")
    public String addNewGenre(
            @RequestParam
                    String name,
                    Model model
            )
    {
        Genre genre = new Genre(name);
        genreRepository.save(genre);

        // ну и отобразим, что получилось
        createGenresList(model);

        return "genre";
    }

    private void createGenresList(Model model) {
        Iterable<Genre> genres = genreRepository.findAll();
        List<Genre> genresList = new ArrayList(); // genres.stream().collect(Collectors.toList());
        genres.forEach(genresList::add);
        model.addAttribute("genresList", genresList);
    }

    @GetMapping(path="/all")
    public String getAllGenres(Model model) {
        // ну и отобразим, что получилось
        createGenresList(model);

        return "genre";
    }

}
